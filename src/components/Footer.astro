<div class="w-full border-t border-stone-700">
    <div class="max-w-3xl mx-auto px-12 py-2 flex justify-between items-center">
        <p class="text-xs text-stone-500">
            <a
                href="mailto:daniel@madeleydesignstudio.com"
                class="hover:text-stone-400 transition-colors"
            >
                daniel@madeleydesignstudio.com
            </a>
        </p>
        <form id="newsletter-form" class="flex items-center gap-2">
            <input
                id="email-input"
                type="email"
                placeholder="Enter your email"
                required
                class="px-3 py-1 text-xs bg-stone-800 border border-stone-600 rounded text-stone-200 placeholder-stone-400 focus:outline-none focus:ring-1 focus:ring-stone-500 focus:border-stone-500 transition-colors"
            />
            <button
                type="submit"
                id="subscribe-btn"
                class="px-3 py-1 text-xs bg-stone-700 hover:bg-stone-600 text-stone-200 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
            >
                Subscribe
            </button>
        </form>
    </div>
    <!-- Success/Error Messages -->
    <div id="subscription-message" class="hidden max-w-3xl mx-auto px-12 py-2">
        <div id="message-content" class="text-xs text-center p-2 rounded"></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('newsletter-form') as HTMLFormElement;
    const emailInput = document.getElementById('email-input') as HTMLInputElement;
    const submitBtn = document.getElementById('subscribe-btn') as HTMLButtonElement;
    const messageContainer = document.getElementById('subscription-message') as HTMLElement;
    const messageContent = document.getElementById('message-content') as HTMLElement;

    if (form && emailInput && submitBtn && messageContainer && messageContent) {
        form.addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = emailInput.value.trim();

            if (!email) {
                showMessage('Please enter your email address.', 'error');
                return;
            }

            // Disable button and show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Subscribing...';

            try {
                const response = await fetch('/api/subscribe', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email }),
                });

                const result = await response.json();

                if (response.ok) {
                    showMessage(result.message, 'success');
                    emailInput.value = '';
                } else {
                    showMessage(result.error || 'Something went wrong. Please try again.', 'error');
                }
            } catch (error) {
                console.error('Subscription error:', error);
                showMessage('Network error. Please try again.', 'error');
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.textContent = 'Subscribe';
            }
        });
    }

    function showMessage(message: string, type: string) {
        if (messageContent) {
            messageContent.textContent = message;
            messageContent.className = `text-xs text-center p-2 rounded ${
                type === 'success'
                    ? 'bg-green-100 text-green-800 border border-green-200'
                    : 'bg-red-100 text-red-800 border border-red-200'
            }`;
        }

        if (messageContainer) {
            messageContainer.classList.remove('hidden');

            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageContainer.classList.add('hidden');
            }, 5000);
        }
    }
});
</script>
