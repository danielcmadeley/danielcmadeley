---
import Layout from "../../layouts/Layout.astro";
import ViewTracker from "../../components/ViewTracker.tsx";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
    const projects = await getCollection("projects");
    return projects.map((project) => ({
        params: { slug: project.id },
        props: { project },
    }));
}

const { project } = Astro.props;
const { Content } = await render(project);

const formatDate = (date: Date) =>
    date.toLocaleDateString("en-US", {
        month: "long",
        year: "numeric",
    });
---

<Layout title={`${project.data.title} | Daniel C Madeley`} description={project.data.description}>
    <article class="pt-12">
        <!-- Hero image -->
        <div class="relative w-full aspect-[21/9] rounded-xl overflow-hidden border border-neutral-800 mb-8">
            <img
                src={project.data.image}
                alt={project.data.title}
                class="w-full h-full object-cover"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-neutral-950/60 via-transparent to-transparent" />
        </div>

        <!-- Header -->
        <div class="space-y-4 mb-10">
            <div class="flex items-center gap-3 text-sm text-neutral-400">
                <time datetime={project.data.date.toISOString()}>
                    {formatDate(project.data.date)}
                </time>
                <span class="text-neutral-700">&middot;</span>
                <ViewTracker client:load slug={`project-${project.id}`} />
                {project.data.url && project.data.url !== "#" && (
                    <>
                        <span class="text-neutral-700">&middot;</span>
                        <a
                            href={project.data.url}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="hover:text-white transition-colors"
                        >
                            Visit project &rarr;
                        </a>
                    </>
                )}
            </div>

            <h1 class="text-4xl font-bold text-white">{project.data.title}</h1>
            <p class="text-lg text-neutral-400 max-w-2xl">{project.data.description}</p>

            {project.data.tags && project.data.tags.length > 0 && (
                <div class="flex flex-wrap gap-2">
                    {project.data.tags.map((tag) => (
                        <span class="px-2.5 py-1 text-xs font-medium rounded-full bg-neutral-800 text-neutral-300 border border-neutral-700">
                            {tag}
                        </span>
                    ))}
                </div>
            )}
        </div>

        <!-- Content -->
        <div class="prose prose-invert prose-neutral max-w-none prose-headings:font-semibold prose-h2:text-2xl prose-h3:text-xl prose-p:text-neutral-300 prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline prose-strong:text-white prose-li:text-neutral-300">
            <Content />
        </div>
    </article>
</Layout>
